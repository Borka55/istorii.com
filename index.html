<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–∞–π—Ç —Å –∏—Å—Ç–æ—Ä–∏—è–º–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .story-container {
            background-color: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .story-title {
            color: #333;
            font-size: 24px;
            margin-bottom: 10px;
        }
        .story-text {
            line-height: 1.6;
            color: #444;
        }
        .nav-menu {
            background-color: #333;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .nav-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            gap: 20px;
        }
        .nav-menu a {
            color: white;
            text-decoration: none;
            font-size: 18px;
            transition: color 0.3s;
        }
        .nav-menu a:hover {
            color: #ffd700;
        }
        .story-form {
            background-color: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .story-form h2 {
            color: #333;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #444;
        }
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .form-group textarea {
            height: 200px;
            resize: vertical;
        }
        .submit-button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .submit-button:hover {
            background-color: #45a049;
        }
        .story-author {
            color: #666;
            font-style: italic;
            margin-bottom: 10px;
        }
        
        .story-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        
        .like-button, .share-button {
            padding: 5px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .like-button.liked {
            background-color: #ff3333;
            opacity: 0.8;
        }
        
        .like-button[disabled] {
            background-color: #ccc;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .like-button:hover:not([disabled]) {
            background-color: #ff3333;
        }
        
        .share-button {
            background-color: #4d79ff;
            color: white;
        }
        
        .share-button:hover {
            background-color: #3366ff;
        }
        
        .stories-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .message {
            padding: 10px 20px;
            border-radius: 4px;
            margin: 10px 0;
            display: none;
        }
        
        .success-message {
            background-color: #dff0d8;
            color: #3c763d;
            border: 1px solid #d6e9c6;
        }
        
        .error-message {
            background-color: #f2dede;
            color: #a94442;
            border: 1px solid #ebccd1;
        }
        
        .form-group .error {
            color: #a94442;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        .search-container {
            margin: 20px 0;
            position: relative;
        }
        
        #searchInput {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        #searchInput:focus {
            border-color: #4CAF50;
            box-shadow: 0 2px 8px rgba(76,175,80,0.2);
            outline: none;
        }
        
        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }
        
        .story-container.hidden {
            display: none;
        }
        
        .no-results {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
            display: none;
        }
        .auth-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
            display: none;
        }
        
        .auth-container.active {
            display: block;
        }
        
        .auth-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .auth-info {
            display: none;
            align-items: center;
            gap: 10px;
        }
        
        .auth-info.active {
            display: flex;
        }
        
        .logout-button {
            background-color: #ff4444;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .user-name {
            font-weight: bold;
            color: #333;
        }
        
        #myStoriesBtn {
            background-color: #4CAF50;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        #myStoriesBtn:hover {
            background-color: #45a049;
        }
        
        .nav-button.active {
            background-color: #45a049;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .no-stories-message {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }
        .password-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .toggle-password {
            position: absolute;
            right: 10px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            font-size: 16px;
            color: #666;
        }

        .toggle-password:hover {
            color: #333;
        }

        .password-container input {
            width: 100%;
            padding-right: 35px;
        }

        #likedStoriesBtn {
            background-color: #4CAF50;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        #likedStoriesBtn:hover {
            background-color: #45a049;
        }
        
        #likedStoriesBtn.active {
            background-color: #45a049;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .like-button {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .like-button.liked {
            background-color: #ffe6e6;
            border-color: #ffcccc;
            color: #ff4444;
        }
        
        .like-button:hover {
            transform: scale(1.05);
            background-color: #f0f0f0;
        }
        
        .like-button.liked:hover {
            background-color: #ffd9d9;
        }

        .nav-button {
            background-color: #4CAF50;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .nav-button:hover {
            background-color: #45a049;
        }

        .auth-prompt {
            color: #666;
            font-size: 0.9em;
            margin-top: 10px;
            padding: 5px;
            background-color: #f8f8f8;
            border-radius: 4px;
            text-align: center;
        }
        
        .story-likes {
            color: #666;
            margin-left: 10px;
        }
        
        .story-container {
            position: relative;
            padding: 20px;
            margin-bottom: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }
        
        .story-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .story-meta {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
            color: #666;
            font-size: 0.9em;
        }

        .share-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .share-modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            position: relative;
            max-width: 400px;
            width: 90%;
        }
        
        .share-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .share-button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            text-align: center;
            text-decoration: none;
            color: white;
            transition: background-color 0.3s;
        }
        
        .share-button.vk {
            background-color: #4a76a8;
        }
        
        .share-button.telegram {
            background-color: #0088cc;
        }
        
        .share-button.copy {
            background-color: #6c757d;
        }
        
        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
        }
        
        .story-actions .share-button {
            background-color: #4CAF50;
            color: white;
            padding: 5px 15px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .story-actions .share-button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <nav class="nav-menu">
        <ul>
            <li><button id="myStoriesBtn" onclick="showMyStories()" style="display: none;">–ú–æ–∏ –∏—Å—Ç–æ—Ä–∏–∏</button></li>
            <li><button id="likedStoriesBtn" onclick="showLikedStories()" style="display: none;">–ü–æ–Ω—Ä–∞–≤–∏–≤—à–∏–µ—Å—è</button></li>
            <li class="auth-buttons" id="authButtons">
                <button onclick="showAuthForm('login')">–í–æ–π—Ç–∏</button>
                <button onclick="showAuthForm('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </li>
            <li class="auth-info" id="authInfo">
                <span class="user-name" id="userName"></span>
                <button class="logout-button" onclick="logout()">–í—ã–π—Ç–∏</button>
            </li>
        </ul>
    </nav>
    
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –∏—Å—Ç–æ—Ä–∏–π</h1>
    
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∞–≤—Ç–æ—Ä—É –∏–ª–∏ —Ç–µ–∫—Å—Ç—É –∏—Å—Ç–æ—Ä–∏–∏...">
        <span class="search-icon">üîç</span>
    </div>
    
    <div id="noResults" class="no-results">
        –ò—Å—Ç–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
    </div>

    <!-- –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∏—Å—Ç–æ—Ä–∏–π -->
    <div class="stories-container">
        <!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ -->
        <div class="story-container">
            <h2 class="story-title">–ò—Å—Ç–æ—Ä–∏—è 1</h2>
            <div class="story-text">
                –í –æ–¥–∏–Ω –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–π –¥–µ–Ω—å –≤ –º–∞–ª–µ–Ω—å–∫–æ–º –≥–æ—Ä–æ–¥–∫–µ —Å–ª—É—á–∏–ª–æ—Å—å –Ω–µ—á—Ç–æ –Ω–µ–æ–±—ã—á–Ω–æ–µ. 
                –í—Å–µ –∂–∏—Ç–µ–ª–∏ –ø—Ä–æ—Å–Ω—É–ª–∏—Å—å –∏ –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏, —á—Ç–æ –∏—Ö –¥–æ–º–∞ –æ–∫—Ä–∞—Å–∏–ª–∏—Å—å –≤ —Ä–∞–∑–Ω—ã–µ —Ü–≤–µ—Ç–∞ —Ä–∞–¥—É–≥–∏. 
                –ù–∏–∫—Ç–æ –Ω–µ –∑–Ω–∞–ª, –∫–∞–∫ —ç—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ, –Ω–æ —ç—Ç–æ—Ç –¥–µ–Ω—å –Ω–∞–≤—Å–µ–≥–¥–∞ –∏–∑–º–µ–Ω–∏–ª –∂–∏–∑–Ω—å –≥–æ—Ä–æ–∂–∞–Ω...
            </div>
        </div>

        <div class="story-container">
            <h2 class="story-title">–ò—Å—Ç–æ—Ä–∏—è 2</h2>
            <div class="story-text">
                –ù–∞ –æ–∫—Ä–∞–∏–Ω–µ –ª–µ—Å–∞ –∂–∏–ª —Å—Ç–∞—Ä—ã–π –º—É–¥—Ä–µ—Ü, –∫–æ—Ç–æ—Ä—ã–π –∑–Ω–∞–ª —è–∑—ã–∫ –∂–∏–≤–æ—Ç–Ω—ã—Ö. 
                –ö–∞–∂–¥–æ–µ —É—Ç—Ä–æ –∫ –Ω–µ–º—É –ø—Ä–∏—Ö–æ–¥–∏–ª–∏ –ª–µ—Å–Ω—ã–µ –∂–∏—Ç–µ–ª–∏ –∏ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–ª–∏ —Å–≤–æ–∏ –∏—Å—Ç–æ—Ä–∏–∏. 
                –û–¥–Ω–∞–∂–¥—ã –ø—Ä–æ–∏–∑–æ—à–ª–æ —á—Ç–æ-—Ç–æ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ —É–¥–∏–≤–∏—Ç–µ–ª—å–Ω–æ–µ...
            </div>
        </div>
    </div>

    <div class="story-form">
        <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∏—Å—Ç–æ—Ä–∏—é</h2>
        <div id="successMessage" class="message success-message">–ò—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!</div>
        <div id="errorMessage" class="message error-message"></div>
        <form id="newStoryForm">
            <div class="form-group">
                <label for="storyTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏:</label>
                <input type="text" id="storyTitle" name="storyTitle" required>
                <div class="error" id="titleError"></div>
            </div>
            
            <div class="form-group">
                <label for="storyText">–¢–µ–∫—Å—Ç –∏—Å—Ç–æ—Ä–∏–∏:</label>
                <textarea id="storyText" name="storyText" required></textarea>
                <div class="error" id="textError"></div>
            </div>
            
            <button type="submit" class="submit-button">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
        </form>
    </div>

    <div class="auth-container" id="authContainer">
        <h2 id="authTitle">–í—Ö–æ–¥</h2>
        <form id="authForm">
            <div class="form-group">
                <label for="username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                <input type="text" id="username" name="username" required>
                <div class="error" id="usernameError"></div>
            </div>
            
            <div class="form-group">
                <label for="password">–ü–∞—Ä–æ–ª—å:</label>
                <div class="password-container">
                    <input type="password" id="password" name="password" required>
                    <button type="button" class="toggle-password" onclick="togglePassword()">üëÅÔ∏è</button>
                </div>
                <div class="error" id="passwordError"></div>
            </div>
            
            <button type="submit" class="submit-button">–í–æ–π—Ç–∏</button>
        </form>
    </div>

    <script>
        function validateStory(data) {
            const sanitizeInput = (input) => {
                return input
                    .replace(/[&<>"']/g, char => ({
                        '&': '&amp;',
                        '<': '&lt;',
                        '>': '&gt;',
                        '"': '&quot;',
                        "'": '&#39;'
                    })[char]);
            };
            
            let isValid = true;
            const errors = {};
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è
            if (!data.storyTitle || data.storyTitle.trim().length < 3) {
                errors.title = '–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞';
                isValid = false;
            } else if (data.storyTitle.length > 100) {
                errors.title = '–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å 100 —Å–∏–º–≤–æ–ª–æ–≤';
                isValid = false;
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –∏—Å—Ç–æ—Ä–∏–∏
            if (!data.storyText || data.storyText.trim().length < 10) {
                errors.text = '–ò—Å—Ç–æ—Ä–∏—è –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤';
                isValid = false;
            } else if (data.storyText.length > 5000) {
                errors.text = '–ò—Å—Ç–æ—Ä–∏—è –Ω–µ –¥–æ–ª–∂–Ω–∞ –ø—Ä–µ–≤—ã—à–∞—Ç—å 5000 —Å–∏–º–≤–æ–ª–æ–≤';
                isValid = false;
            }
            
            // –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
            if (isValid) {
                data.storyTitle = sanitizeInput(data.storyTitle);
                data.storyText = sanitizeInput(data.storyText);
            }
            
            return { isValid, errors };
        }

        function showError(field, message) {
            try {
                const errorElement = document.getElementById(`${field}Error`);
                if (errorElement) {
                    errorElement.textContent = message;
                    errorElement.style.display = 'block';
                    
                    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –ø–æ–ª–µ —Å –æ—à–∏–±–∫–æ–π
                    const inputElement = document.getElementById(field);
                    if (inputElement) {
                        inputElement.classList.add('error');
                        // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                        setTimeout(() => {
                            inputElement.classList.remove('error');
                        }, 3000);
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ –ø–æ–ª—è:', error);
            }
        }

        function clearErrors() {
            try {
                // –û—á–∏—â–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
                const errorElements = document.querySelectorAll('.error-message');
                errorElements.forEach(element => {
                    element.textContent = '';
                    element.style.display = 'none';
                });
                
                // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø–æ–ª–µ–π —Å –æ—à–∏–±–∫–∞–º–∏
                const inputElements = document.querySelectorAll('.error');
                inputElements.forEach(element => {
                    element.classList.remove('error');
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –æ—à–∏–±–æ–∫:', error);
            }
        }

        function showMessage(type, message, duration = 3000) {
            try {
                const messageContainer = document.getElementById('messageContainer');
                if (!messageContainer) return;
                
                // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
                const messageElement = document.createElement('div');
                messageElement.className = `message ${type}-message`;
                messageElement.textContent = message;
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                messageContainer.appendChild(messageElement);
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
                setTimeout(() => {
                    messageElement.classList.add('show');
                }, 100);
                
                // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
                setTimeout(() => {
                    messageElement.classList.remove('show');
                    setTimeout(() => {
                        messageContainer.removeChild(messageElement);
                    }, 300);
                }, duration);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫–∞–∑–µ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∂–∏–º–∞ –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
        function checkBrowserMode() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å localStorage
                const test = '__storage_test__';
                localStorage.setItem(test, test);
                localStorage.removeItem(test);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
                let size = 0;
                const testData = 'x'.repeat(1024 * 1024); // 1MB –¥–∞–Ω–Ω—ã—Ö
                try {
                    for (let i = 0; size < 10; i++) {
                        localStorage.setItem(`test${i}`, testData);
                        size++;
                    }
                } catch (e) {
                    // –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
                } finally {
                    // –û—á–∏—â–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                    for (let i = 0; i < size; i++) {
                        localStorage.removeItem(`test${i}`);
                    }
                }
                
                return {
                    isAvailable: true,
                    isPrivateMode: size < 5, // –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ –º–µ–Ω–µ–µ 5MB, –≤–µ—Ä–æ—è—Ç–Ω–æ —ç—Ç–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º
                    storageSize: size
                };
            } catch (e) {
                return {
                    isAvailable: false,
                    isPrivateMode: true,
                    storageSize: 0
                };
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å —É—á–µ—Ç–æ–º —Ä–µ–∂–∏–º–∞ –±—Ä–∞—É–∑–µ—Ä–∞
        function initializeWithBrowserMode() {
            const browserMode = checkBrowserMode();
            
            if (!browserMode.isAvailable) {
                showBrowserModeWarning('storage-unavailable');
                return false;
            }
            
            if (browserMode.isPrivateMode) {
                showBrowserModeWarning('private-mode');
                // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É, –Ω–æ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏
                return true;
            }
            
            return true;
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ —Ä–µ–∂–∏–º–µ –±—Ä–∞—É–∑–µ—Ä–∞
        function showBrowserModeWarning(type) {
            const warningContainer = document.createElement('div');
            warningContainer.className = 'browser-mode-warning';
            
            switch (type) {
                case 'storage-unavailable':
                    warningContainer.innerHTML = `
                        <div class="warning-message">
                            <h3>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: –•—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</h3>
                            <p>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Ö—Ä–∞–Ω–∏–ª–∏—â—É. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:</p>
                            <ul>
                                <li>–í—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º –±—Ä–∞—É–∑–µ—Ä–∞</li>
                                <li>–í –±—Ä–∞—É–∑–µ—Ä–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ</li>
                                <li>–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ</li>
                            </ul>
                            <p>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</p>
                            <ul>
                                <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º –±—Ä–∞—É–∑–µ—Ä–∞</li>
                                <li>–û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –∏ –¥–∞–Ω–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä–∞</li>
                                <li>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä</li>
                            </ul>
                        </div>
                    `;
                    break;
                    
                case 'private-mode':
                    warningContainer.innerHTML = `
                        <div class="warning-message">
                            <h3>‚ÑπÔ∏è –ü—Ä–∏–≤–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º</h3>
                            <p>–í—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º –±—Ä–∞—É–∑–µ—Ä–∞. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:</p>
                            <ul>
                                <li>–î–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å —É—Ç–µ—Ä—è–Ω—ã –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏</li>
                                <li>–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</li>
                                <li>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –±—É–¥–µ—Ç —Å–±—Ä–æ—à–µ–Ω–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞</li>
                            </ul>
                            <p>–î–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º.</p>
                        </div>
                    `;
                    break;
            }
            
            document.body.insertBefore(warningContainer, document.body.firstChild);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º —Å —É—á–µ—Ç–æ–º —Ä–µ–∂–∏–º–∞ –±—Ä–∞—É–∑–µ—Ä–∞
        function safeStorage(operation, key, data = null) {
            try {
                switch (operation) {
                    case 'get':
                        const item = localStorage.getItem(key);
                        if (!item) return null;
                        try {
                            return JSON.parse(item);
                        } catch (e) {
                            console.error('Invalid JSON in storage:', e);
                            return null;
                        }
                        
                    case 'set':
                        if (data === null) return false;
                        localStorage.setItem(key, JSON.stringify(data));
                        return true;
                        
                    case 'remove':
                        localStorage.removeItem(key);
                        return true;
                        
                    case 'clear':
                        localStorage.clear();
                        return true;
                        
                    default:
                        throw new Error('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º');
                }
            } catch (error) {
                console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º (${operation}):`, error);
                showMessage('error', '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏');
                return null;
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
        function getStoriesFromLocalStorage() {
            return safeStorage('get', 'stories') || [];
        }

        function saveStoriesToLocalStorage(stories) {
            return safeStorage('set', 'stories', stories);
        }

        function getCurrentUser() {
            return safeStorage('get', 'currentUser');
        }

        function setCurrentUser(user) {
            return safeStorage('set', 'currentUser', user);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–µ–∂–∏–º–∞ –±—Ä–∞—É–∑–µ—Ä–∞
        document.addEventListener('DOMContentLoaded', () => {
            if (initializeWithBrowserMode()) {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                initializeApp();
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initializeApp() {
            try {
                console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
                if (!localStorage.getItem('stories')) {
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –∏—Å—Ç–æ—Ä–∏—é, –µ—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏–π –Ω–µ—Ç
                    const initialStories = [{
                        id: 'welcome-story',
                        title: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!',
                        text: '–≠—Ç–æ –ø–µ—Ä–≤–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤ –Ω–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –¥–µ–ª–∏—Ç—å—Å—è —Å–≤–æ–∏–º–∏ –∏—Å—Ç–æ—Ä–∏—è–º–∏ –∏ —á–∏—Ç–∞—Ç—å –∏—Å—Ç–æ—Ä–∏–∏ –¥—Ä—É–≥–∏—Ö –ª—é–¥–µ–π.',
                        authorName: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                        date: new Date().toISOString(),
                        likes: 0,
                        likedBy: []
                    }];
                    localStorage.setItem('stories', JSON.stringify(initialStories));
                }
                
                // –û—Å—Ç–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
                updateAuthUI();
                displayStories();
                setupEventListeners();
                
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                return false;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –§–æ—Ä–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            const authForm = document.getElementById('authForm');
            if (authForm) {
                authForm.addEventListener('submit', handleAuthSubmit);
            }
            
            // –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
            const storyForm = document.getElementById('newStoryForm');
            if (storyForm) {
                storyForm.addEventListener('submit', handleStorySubmit);
            }
            
            // –ü–æ–∏—Å–∫ –∏—Å—Ç–æ—Ä–∏–π
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', debounce((e) => {
                    if (e && e.target) {
                        searchStories(e.target.value);
                    }
                }, 300));
                
                // –û—á–∏—Å—Ç–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–æ Escape
                searchInput.addEventListener('keyup', (e) => {
                    if (e.key === 'Escape') {
                        searchInput.value = '';
                        searchStories('');
                    }
                });
            }
            
            // –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            const myStoriesBtn = document.getElementById('myStoriesBtn');
            if (myStoriesBtn) {
                myStoriesBtn.addEventListener('click', showMyStories);
            }
            
            const likedStoriesBtn = document.getElementById('likedStoriesBtn');
            if (likedStoriesBtn) {
                likedStoriesBtn.addEventListener('click', showLikedStories);
            }
            
            // –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞
            const logoutButton = document.querySelector('.logout-button');
            if (logoutButton) {
                logoutButton.addEventListener('click', logout);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ UI
        function initializeUI() {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            updateAuthUI();
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏–∏
            displayStories();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∏—Å–∫–∞
            const searchInput = document.getElementById('searchInput');
            if (searchInput && searchInput.value) {
                searchStories(searchInput.value);
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            showMessage('success', '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ');
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function disableAppFunctionality() {
            const elements = {
                storyForm: document.querySelector('.story-form'),
                authButtons: document.querySelector('.auth-buttons'),
                storiesContainer: document.querySelector('.stories-container')
            };
            
            // –û—Ç–∫–ª—é—á–∞–µ–º —Ñ–æ—Ä–º—ã –∏ –∫–Ω–æ–ø–∫–∏
            if (elements.storyForm) {
                elements.storyForm.style.display = 'none';
            }
            
            if (elements.authButtons) {
                elements.authButtons.style.display = 'none';
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –∏—Å—Ç–æ—Ä–∏–π
            if (elements.storiesContainer) {
                elements.storiesContainer.innerHTML = `
                    <div class="error-message">
                        <h3>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</h3>
                        <p>–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ:</p>
                        <ul>
                            <li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º –±—Ä–∞—É–∑–µ—Ä–∞</li>
                            <li>–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞</li>
                            <li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä</li>
                        </ul>
                    </div>
                `;
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è UI
        function updateAuthUI() {
            try {
                const currentUser = getCurrentUser();
                const elements = {
                    // –≠–ª–µ–º–µ–Ω—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                    authButtons: document.querySelector('.auth-buttons'),
                    authInfo: document.querySelector('.auth-info'),
                    authContainer: document.getElementById('authContainer'),
                    userName: document.getElementById('userName'),
                    
                    // –§–æ—Ä–º—ã
                    storyForm: document.querySelector('.story-form'),
                    newStoryForm: document.getElementById('newStoryForm'),
                    
                    // –ù–∞–≤–∏–≥–∞—Ü–∏—è
                    myStoriesBtn: document.getElementById('myStoriesBtn'),
                    likedStoriesBtn: document.getElementById('likedStoriesBtn'),
                    
                    // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
                    storiesContainer: document.querySelector('.stories-container'),
                    searchContainer: document.querySelector('.search-container')
                };
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                if (!elements.authButtons || !elements.authInfo) {
                    console.error('–ù–µ –Ω–∞–π–¥–µ–Ω—ã –æ—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞');
                    return;
                }
                
                if (currentUser) {
                    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
                    // –≠–ª–µ–º–µ–Ω—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                    elements.authButtons.style.display = 'none';
                    elements.authInfo.style.display = 'flex';
                    if (elements.authContainer) {
                        elements.authContainer.classList.remove('active');
                    }
                    
                    // –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    if (elements.userName) {
                        elements.userName.textContent = currentUser.username;
                    }
                    
                    // –§–æ—Ä–º—ã
                    if (elements.storyForm) {
                        elements.storyForm.style.display = 'block';
                    }
                    if (elements.newStoryForm) {
                        elements.newStoryForm.style.display = 'block';
                    }
                    
                    // –ù–∞–≤–∏–≥–∞—Ü–∏—è
                    if (elements.myStoriesBtn) {
                        elements.myStoriesBtn.style.display = 'block';
                    }
                    if (elements.likedStoriesBtn) {
                        elements.likedStoriesBtn.style.display = 'block';
                    }
                    
                    // –ü–æ–∏—Å–∫
                    if (elements.searchContainer) {
                        elements.searchContainer.style.display = 'block';
                    }
                    
                } else {
                    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
                    // –≠–ª–µ–º–µ–Ω—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                    elements.authButtons.style.display = 'flex';
                    elements.authInfo.style.display = 'none';
                    
                    // –û—á–∏—â–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    if (elements.userName) {
                        elements.userName.textContent = '';
                    }
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—ã
                    if (elements.storyForm) {
                        elements.storyForm.style.display = 'none';
                    }
                    if (elements.newStoryForm) {
                        elements.newStoryForm.style.display = 'none';
                    }
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
                    if (elements.myStoriesBtn) {
                        elements.myStoriesBtn.style.display = 'none';
                    }
                    if (elements.likedStoriesBtn) {
                        elements.likedStoriesBtn.style.display = 'none';
                    }
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–π
                displayStories();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:', error);
                showMessage('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç–∞
        function toggleElement(element, show) {
            if (element) {
                element.style.display = show ? 'block' : 'none';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è —Ñ–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function toggleAuthForm(type) {
            const authContainer = document.getElementById('authContainer');
            const authForm = document.getElementById('authForm');
            const authTitle = document.querySelector('.auth-title');
            
            if (!authContainer || !authForm || !authTitle) {
                console.error('–ù–µ –Ω–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
                return;
            }
            
            // –û—á–∏—â–∞–µ–º –æ—à–∏–±–∫–∏ –∏ —Ñ–æ—Ä–º—É
            clearErrors();
            authForm.reset();
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∏–ø —Ñ–æ—Ä–º—ã
            authForm.dataset.type = type;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            authTitle.textContent = type === 'register' ? '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è' : '–í—Ö–æ–¥';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
            authContainer.classList.add('active');
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è —Ñ–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function hideAuthForm() {
            const authContainer = document.getElementById('authContainer');
            if (authContainer) {
                authContainer.classList.remove('active');
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –≤–Ω–µ —Ñ–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        document.addEventListener('click', (e) => {
            const authContainer = document.getElementById('authContainer');
            if (authContainer && e.target === authContainer) {
                hideAuthForm();
            }
        });

        // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏—Ö—Å—è –∏—Å—Ç–æ—Ä–∏–π
        function showLikedStories() {
            const currentUser = getCurrentUser();
            if (!currentUser) {
                showMessage('error', '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
            const allButtons = document.querySelectorAll('.nav-menu button');
            allButtons.forEach(btn => btn.classList.remove('active'));
            document.getElementById('likedStoriesBtn').classList.add('active');
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–µ—Å—è –∏—Å—Ç–æ—Ä–∏–∏
            displayStories(story => story.likedBy && story.likedBy.includes(currentUser.username));
            
            const stories = document.querySelectorAll('.story-container');
            if (stories.length === 0) {
                document.querySelector('.stories-container').innerHTML = `
                    <div class="no-stories-message">
                        –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏—Ö—Å—è –∏—Å—Ç–æ—Ä–∏–π
                    </div>
                `;
            }
        }

        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggleButton = document.querySelector('.toggle-password');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleButton.textContent = 'üëÅÔ∏è‚Äçüó®Ô∏è';
            } else {
                passwordInput.type = 'password';
                toggleButton.textContent = 'üëÅÔ∏è';
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é handleStorySubmit
        async function handleStorySubmit(e) {
            e.preventDefault();
            clearErrors();
            
            try {
                const currentUser = getCurrentUser();
                if (!currentUser) {
                    showMessage('error', '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
                    return;
                }
                
                const formData = new FormData(e.target);
                const storyData = {
                    id: crypto.randomUUID(), // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ ID –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è
                    title: formData.get('storyTitle')?.trim(),
                    text: formData.get('storyText')?.trim(),
                    authorName: currentUser.username,
                    date: new Date().toISOString(),
                    likes: 0, // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—á–µ—Ç—á–∏–∫ –ª–∞–π–∫–æ–≤
                    likedBy: [] // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                };
                
                const { isValid, errors } = validateStory(storyData);
                
                if (!isValid) {
                    Object.keys(errors).forEach(key => {
                        showError(key, errors[key]);
                    });
                    return;
                }
                
                const stories = JSON.parse(localStorage.getItem('stories') || '[]');
                stories.unshift(storyData);
                localStorage.setItem('stories', JSON.stringify(stories));
                
                e.target.reset();
                displayStories();
                showMessage('success', '–ò—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏:', error);
                showMessage('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏');
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é handleLike
        function handleLike(button, storyId) {
            console.log('handleLike –≤—ã–∑–≤–∞–Ω:', { button, storyId }); // –û—Ç–ª–∞–¥–∫–∞
            
            try {
                const currentUser = getCurrentUser();
                if (!currentUser) {
                    showMessage('error', '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∏—Å—Ç–æ—Ä–∏–π');
                    return;
                }
                
                const stories = JSON.parse(localStorage.getItem('stories') || '[]');
                const storyIndex = stories.findIndex(s => s.id === storyId);
                
                if (storyIndex === -1) {
                    console.error('–ò—Å—Ç–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:', storyId);
                    return;
                }
                
                const story = stories[storyIndex];
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–ª—è, –µ—Å–ª–∏ –æ–Ω–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
                if (!Array.isArray(story.likedBy)) {
                    story.likedBy = [];
                }
                if (typeof story.likes !== 'number') {
                    story.likes = 0;
                }
                
                const hasLiked = story.likedBy.includes(currentUser.username);
                console.log('–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ª–∞–π–∫–∞:', { hasLiked, likedBy: story.likedBy }); // –û—Ç–ª–∞–¥–∫–∞
                
                if (hasLiked) {
                    story.likedBy = story.likedBy.filter(username => username !== currentUser.username);
                    story.likes = Math.max(0, story.likes - 1);
                } else {
                    story.likedBy.push(currentUser.username);
                    story.likes += 1;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º localStorage
                localStorage.setItem('stories', JSON.stringify(stories));
                console.log('–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏:', stories); // –û—Ç–ª–∞–¥–∫–∞
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                displayStories();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ª–∞–π–∫–∞:', error);
                showMessage('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ª–∞–π–∫–∞');
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é displayStories
        function displayStories(filterFn = null) {
            try {
                const storiesContainer = document.querySelector('.stories-container');
                if (!storiesContainer) {
                    console.error('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏—Å—Ç–æ—Ä–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    return;
                }
                
                let stories = JSON.parse(localStorage.getItem('stories') || '[]');
                console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏:', stories); // –û—Ç–ª–∞–¥–∫–∞
                
                const currentUser = getCurrentUser();
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
                if (filterFn) {
                    stories = stories.filter(filterFn);
                }
                
                // –ï—Å–ª–∏ –Ω–µ—Ç –∏—Å—Ç–æ—Ä–∏–π, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                if (stories.length === 0) {
                    storiesContainer.innerHTML = `
                        <div class="no-stories-message">
                            –ü–æ–∫–∞ –Ω–µ—Ç –∏—Å—Ç–æ—Ä–∏–π
                        </div>
                    `;
                    return;
                }
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º HTML –¥–ª—è –∫–∞–∂–¥–æ–π –∏—Å—Ç–æ—Ä–∏–∏
                const storiesHTML = stories.map(story => {
                    const hasLiked = currentUser && story.likedBy && story.likedBy.includes(currentUser.username);
                    const isAuthor = currentUser && story.authorName === currentUser.username;
                    
                    return `
                        <div class="story-container" data-id="${story.id}">
                            <h3 class="story-title">${escapeHtml(story.title)}</h3>
                            <p class="story-text">${escapeHtml(story.text)}</p>
                            <div class="story-meta">
                                <span class="story-author">–ê–≤—Ç–æ—Ä: ${escapeHtml(story.authorName || '–ê–Ω–æ–Ω–∏–º')}</span>
                                <span class="story-date">${formatDate(story.date)}</span>
                                <span class="story-likes">üë• ${story.likes || 0}</span>
                            </div>
                            <div class="story-actions">
                                <button 
                                    type="button"
                                    class="share-button"
                                    onclick="shareStory(this, '${story.id}')"
                                >
                                    üîó –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
                                </button>
                                ${currentUser ? `
                                    <button 
                                        type="button"
                                        class="like-button ${hasLiked ? 'liked' : ''}"
                                        onclick="handleLike(this, '${story.id}')"
                                        data-story-id="${story.id}"
                                    >
                                        ${hasLiked ? '‚ù§Ô∏è' : 'ü§ç'} ${story.likes || 0}
                                    </button>
                                    ${isAuthor ? `
                                        <button 
                                            type="button"
                                            class="delete-button"
                                            onclick="deleteStory('${story.id}')"
                                        >
                                            üóëÔ∏è
                                        </button>
                                    ` : ''}
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
                
                storiesContainer.innerHTML = storiesHTML;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫
                const likeButtons = storiesContainer.querySelectorAll('.like-button');
                likeButtons.forEach(button => {
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        const storyId = this.dataset.storyId;
                        handleLike(this, storyId);
                    });
                });
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–π:', error);
                showMessage('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–π');
            }
        }

        function searchStories(query) {
            const stories = document.querySelectorAll('.story-container');
            const noResults = document.getElementById('noResults');
            let hasVisibleStories = false;
            
            stories.forEach(story => {
                const title = story.querySelector('.story-title').textContent.toLowerCase();
                const text = story.querySelector('.story-text').textContent.toLowerCase();
                const author = story.querySelector('.story-author')?.textContent.toLowerCase() || '';
                
                const searchQuery = query.toLowerCase();
                
                if (title.includes(searchQuery) || 
                    text.includes(searchQuery) || 
                    author.includes(searchQuery)) {
                    story.classList.remove('hidden');
                    hasVisibleStories = true;
                } else {
                    story.classList.add('hidden');
                }
            });
            
            noResults.style.display = hasVisibleStories ? 'none' : 'block';
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è —Å debounce
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('input', debounce((e) => {
                if (e && e.target) {
                    searchStories(e.target.value);
                }
            }, 300));
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø–æ–∏—Å–∫–∞
        searchInput.addEventListener('keyup', (e) => {
            if (e.key === 'Escape') {
                searchInput.value = '';
                searchStories('');
            }
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function handleRegistration(username, password) {
            const users = getUsers();
            
            if (users.some(u => u.username === username)) {
                showError('username', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                return;
            }
            
            if (password.length < 6) {
                showError('password', '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤');
                return;
            }
            
            const newUser = { 
                username, 
                password,
                registrationDate: new Date().toISOString()
            };
            
            users.push(newUser);
            
            if (saveUsers(users)) {
                setCurrentUser(newUser);
                showMessage('success', '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!');
                const authContainer = document.getElementById('authContainer');
                if (authContainer) {
                    authContainer.classList.remove('active');
                }
                const authForm = document.getElementById('authForm');
                if (authForm) {
                    authForm.reset();
                }
                updateAuthUI();
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–æ–≥–∏–Ω–∞
        function handleLogin(username, password) {
            const users = getUsers();
            const user = users.find(u => u.username === username && u.password === password);
            
            if (!user) {
                if (!users.some(u => u.username === username)) {
                    showError('username', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º –Ω–µ –Ω–∞–π–¥–µ–Ω');
                } else {
                    showError('password', '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
                }
                return;
            }
            
            if (setCurrentUser(user)) {
                showMessage('success', '–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
                const authContainer = document.getElementById('authContainer');
                if (authContainer) {
                    authContainer.classList.remove('active');
                }
                const authForm = document.getElementById('authForm');
                if (authForm) {
                    authForm.reset();
                }
                updateAuthUI();
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≤—ã—Ö–æ–¥–∞
        function logout() {
            try {
                localStorage.removeItem('currentUser');
                updateAuthUI();
                showMessage('success', '–í—ã —É—Å–ø–µ—à–Ω–æ –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
                displayStories(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–π
                
                // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                const authForm = document.getElementById('authForm');
                if (authForm) {
                    authForm.reset();
                }
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∏—Å–∫
                const searchInput = document.getElementById('searchInput');
                if (searchInput) {
                    searchInput.value = '';
                    searchStories('');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ:', error);
                showMessage('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) {
                    throw new Error('Invalid date');
                }
                return date.toLocaleString('ru-RU', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (error) {
                console.error('Error formatting date:', error);
                return '–î–∞—Ç–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ API
        function handleError(error, context = '', defaultMessage = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞') {
            // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
            const errorLog = {
                timestamp: new Date().toISOString(),
                message: error.message || defaultMessage,
                stack: error.stack,
                context: context
            };
            
            console.error('Error:', errorLog);
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–∞
            try {
                const errorLogs = JSON.parse(localStorage.getItem('errorLogs') || '[]');
                errorLogs.push(errorLog);
                if (errorLogs.length > 50) errorLogs.shift();
                localStorage.setItem('errorLogs', JSON.stringify(errorLogs));
            } catch (e) {
                console.error('Error saving error log:', e);
            }
            
            // –ü–æ–∫–∞–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            showMessage('error', error.message || defaultMessage);
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        function validateAndRepairData() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞—Å—Å–∏–≤ –∏—Å—Ç–æ—Ä–∏–π
                let stories = getStoriesFromLocalStorage();
                if (!Array.isArray(stories)) {
                    console.warn('–ü–æ–≤—Ä–µ–∂–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–π, –≤—ã–ø–æ–ª–Ω—è–µ–º —Å–±—Ä–æ—Å');
                    stories = [];
                    saveStoriesToLocalStorage(stories);
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞—Å—Å–∏–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                let users = getUsers();
                if (!Array.isArray(users)) {
                    console.warn('–ü–æ–≤—Ä–µ–∂–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –≤—ã–ø–æ–ª–Ω—è–µ–º —Å–±—Ä–æ—Å');
                    users = [];
                    saveUsers(users);
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const currentUser = getCurrentUser();
                if (currentUser && !users.some(u => u.username === currentUser.username)) {
                    console.warn('–°–µ—Å—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞, –≤—ã–ø–æ–ª–Ω—è–µ–º –≤—ã—Ö–æ–¥');
                    logout();
                }
                
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
                showMessage('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
                return false;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫
        function logError(error, context = '') {
            const errorLog = {
                timestamp: new Date().toISOString(),
                message: error.message,
                stack: error.stack,
                context: context
            };
            
            console.error('Logged Error:', errorLog);
            
            try {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–≥ –æ—à–∏–±–∫–∏
                const errorLogs = JSON.parse(localStorage.getItem('errorLogs') || '[]');
                errorLogs.push(errorLog);
                // –•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 –æ—à–∏–±–æ–∫
                if (errorLogs.length > 50) {
                    errorLogs.shift();
                }
                localStorage.setItem('errorLogs', JSON.stringify(errorLogs));
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ª–æ–≥–∞ –æ—à–∏–±–æ–∫:', e);
            }
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
        window.onerror = function(message, source, lineno, colno, error) {
            logError(error || new Error(message), 'Global Error Handler');
            return false;
        };

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –ø—Ä–æ–º–∏—Å–æ–≤
        window.addEventListener('unhandledrejection', function(event) {
            logError(event.reason, 'Unhandled Promise Rejection');
        });

        // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function diagnoseApp() {
            try {
                console.log('–ù–∞—á–∞–ª–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
                const storageStatus = checkBrowserMode();
                console.log('–°—Ç–∞—Ç—É—Å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:', storageStatus);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
                const stories = getStoriesFromLocalStorage();
                const users = getUsers();
                const currentUser = getCurrentUser();
                
                console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å—Ç–æ—Ä–∏–π:', stories.length);
                console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', users.length);
                console.log('–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', currentUser ? currentUser.username : '–Ω–µ—Ç');
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
                const criticalElements = {
                    storiesContainer: document.querySelector('.stories-container'),
                    authButtons: document.querySelector('.auth-buttons'),
                    authInfo: document.querySelector('.auth-info'),
                    storyForm: document.querySelector('.story-form'),
                    messageContainer: document.getElementById('messageContainer')
                };
                
                Object.entries(criticalElements).forEach(([name, element]) => {
                    console.log(`–≠–ª–µ–º–µ–Ω—Ç ${name}:`, element ? '–Ω–∞–π–¥–µ–Ω' : '–Ω–µ –Ω–∞–π–¥–µ–Ω');
                });
                
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ:', error);
                return false;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        function repairData() {
            try {
                console.log('–ù–∞—á–∞–ª–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö...');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏–∏
                let stories = getStoriesFromLocalStorage();
                if (!Array.isArray(stories)) {
                    console.warn('–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏—Å—Ç–æ—Ä–∏–π');
                    stories = [];
                    saveStoriesToLocalStorage(stories);
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é –∏—Å—Ç–æ—Ä–∏—é
                stories = stories.filter(story => {
                    if (!story || !story.id || !story.title || !story.text) {
                        console.warn('–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏:', story);
                        return false;
                    }
                    // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
                    story.likes = story.likes || 0;
                    story.likedBy = Array.isArray(story.likedBy) ? story.likedBy : [];
                    story.date = story.date || new Date().toISOString();
                    return true;
                });
                
                saveStoriesToLocalStorage(stories);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                let users = getUsers();
                if (!Array.isArray(users)) {
                    console.warn('–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π');
                    users = [];
                    saveUsers(users);
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const currentUser = getCurrentUser();
                if (currentUser && !users.some(u => u.username === currentUser.username)) {
                    console.warn('–°–±—Ä–æ—Å –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π —Å–µ—Å—Å–∏–∏');
                    logout();
                }
                
                console.log('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                return false;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
        function validateStoryData(story) {
            const errors = [];
            
            if (!story.title || story.title.trim().length === 0) {
                errors.push('–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏—Å—Ç–æ—Ä–∏–∏');
            }
            
            if (!story.text || story.text.trim().length === 0) {
                errors.push('–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ–∫—Å—Ç –∏—Å—Ç–æ—Ä–∏–∏');
            }
            
            if (!story.authorName) {
                errors.push('–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∞–≤—Ç–æ—Ä –∏—Å—Ç–æ—Ä–∏–∏');
            }
            
            if (!story.date) {
                errors.push('–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è');
            }
            
            return {
                isValid: errors.length === 0,
                errors: errors
            };
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            if (diagnoseApp()) {
                repairData();
                initializeApp();
            } else {
                showMessage('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
            }
        });

        // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∏—Å—Ç–æ—Ä–∏–π
        function showNewStories() {
            try {
                const stories = getStoriesFromLocalStorage();
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ –¥–∞—Ç–µ (—Å–∞–º—ã–µ –Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–µ)
                const sortedStories = stories.sort((a, b) => {
                    return new Date(b.date) - new Date(a.date);
                });
                
                // –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∏—Å—Ç–æ—Ä–∏–π
                const recentStories = sortedStories.slice(0, 10);
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏–∏ —Å –ø–æ–º–µ—Ç–∫–æ–π "–ù–æ–≤—ã–µ –∏—Å—Ç–æ—Ä–∏–∏"
                const storiesContainer = document.querySelector('.stories-container');
                if (!storiesContainer) return;
                
                if (recentStories.length === 0) {
                    storiesContainer.innerHTML = `
                        <div class="no-stories-message">
                            –ü–æ–∫–∞ –Ω–µ—Ç –Ω–æ–≤—ã—Ö –∏—Å—Ç–æ—Ä–∏–π
                        </div>
                    `;
                    return;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è —Å–µ–∫—Ü–∏–∏
                storiesContainer.innerHTML = `
                    <div class="stories-section-title">
                        <h2>–ù–æ–≤—ã–µ –∏—Å—Ç–æ—Ä–∏–∏</h2>
                        <span class="stories-count">(–ø–æ—Å–ª–µ–¥–Ω–∏–µ ${recentStories.length} –∏—Å—Ç–æ—Ä–∏–π)</span>
                    </div>
                `;
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏–∏
                const storiesHTML = recentStories.map(story => {
                    const currentUser = getCurrentUser();
                    const hasLiked = currentUser && story.likedBy && story.likedBy.includes(currentUser.username);
                    const isAuthor = currentUser && story.authorName === currentUser.username;
                    const timeAgo = getTimeAgo(new Date(story.date));
                    
                    return `
                        <div class="story-container" data-id="${story.id}">
                            <div class="story-header">
                                <h3 class="story-title">${escapeHtml(story.title)}</h3>
                                <span class="story-time">${timeAgo}</span>
                            </div>
                            <p class="story-text">${escapeHtml(story.text)}</p>
                            <div class="story-meta">
                                <span class="story-author">–ê–≤—Ç–æ—Ä: ${escapeHtml(story.authorName)}</span>
                                <span class="story-date">${formatDate(story.date)}</span>
                            </div>
                            <div class="story-actions">
                                ${currentUser ? `
                                    <button 
                                        class="like-button ${hasLiked ? 'liked' : ''}"
                                        onclick="handleLike(this, '${story.id}')"
                                    >
                                        ${hasLiked ? '‚ù§Ô∏è' : 'ü§ç'} ${story.likes}
                                    </button>
                                    ${isAuthor ? `
                                        <button 
                                            class="delete-button"
                                            onclick="deleteStory('${story.id}')"
                                        >
                                            üóëÔ∏è
                                        </button>
                                    ` : ''}
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
                
                storiesContainer.innerHTML += storiesHTML;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∏—Å—Ç–æ—Ä–∏–π:', error);
                showMessage('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤—ã—Ö –∏—Å—Ç–æ—Ä–∏–π');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ "–ø—Ä–æ—à–ª–æ —Å –º–æ–º–µ–Ω—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏"
        function getTimeAgo(date) {
            const now = new Date();
            const diff = now - date;
            
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (days > 0) {
                return `${days} ${getDeclension(days, ['–¥–µ–Ω—å', '–¥–Ω—è', '–¥–Ω–µ–π'])} –Ω–∞–∑–∞–¥`;
            } else if (hours > 0) {
                return `${hours} ${getDeclension(hours, ['—á–∞—Å', '—á–∞—Å–∞', '—á–∞—Å–æ–≤'])} –Ω–∞–∑–∞–¥`;
            } else if (minutes > 0) {
                return `${minutes} ${getDeclension(minutes, ['–º–∏–Ω—É—Ç—É', '–º–∏–Ω—É—Ç—ã', '–º–∏–Ω—É—Ç'])} –Ω–∞–∑–∞–¥`;
            } else {
                return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–ª–æ–Ω–µ–Ω–∏—è —Å–ª–æ–≤
        function getDeclension(number, titles) {
            const cases = [2, 0, 1, 1, 1, 2];
            return titles[
                (number % 100 > 4 && number % 100 < 20) ? 2 : 
                cases[(number % 10 < 5) ? number % 10 : 5]
            ];
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–æ–≤—ã–µ –∏—Å—Ç–æ—Ä–∏–∏"
        document.addEventListener('DOMContentLoaded', () => {
            const newStoriesBtn = document.getElementById('newStoriesBtn');
            if (newStoriesBtn) {
                newStoriesBtn.addEventListener('click', () => {
                    showNewStories();
                    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
                    document.querySelectorAll('.nav-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    newStoriesBtn.classList.add('active');
                });
            }
        });

        function debounce(func, wait) {
            let timeout;
            const debouncedFunction = function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
            
            debouncedFunction.cancel = function() {
                clearTimeout(timeout);
            };
            
            return debouncedFunction;
        }

        // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞
        async function shareStory(button, storyId) {
            try {
                const stories = JSON.parse(localStorage.getItem('stories') || '[]');
                const story = stories.find(s => s.id === storyId);
                
                if (!story) {
                    showMessage('error', '–ò—Å—Ç–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                    return;
                }

                const shareData = {
                    title: story.title,
                    text: `${story.text.substring(0, 100)}...`,
                    url: window.location.href
                };

                if (navigator.share && navigator.canShare(shareData)) {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Ç–∏–≤–Ω—ã–π —à–∞—Ä–∏–Ω–≥ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
                    try {
                        await navigator.share(shareData);
                        showMessage('success', '–ò—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞');
                    } catch (err) {
                        if (err.name !== 'AbortError') {
                            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —à–∞—Ä–∏–Ω–≥–µ:', err);
                            showFallbackShare(story);
                        }
                    }
                } else {
                    // –ó–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–æ–≤
                    showFallbackShare(story);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —à–∞—Ä–∏–Ω–≥–µ:', error);
                showMessage('error', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –∏—Å—Ç–æ—Ä–∏–µ–π');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –∑–∞–ø–∞—Å–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —à–∞—Ä–∏–Ω–≥–∞
        function showFallbackShare(story) {
            const shareUrl = window.location.href;
            const shareText = `${story.title}\n\n${story.text.substring(0, 100)}...\n\n–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ: ${shareUrl}`;
            
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
            const textarea = document.createElement('textarea');
            textarea.value = shareText;
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                showMessage('success', '–¢–µ–∫—Å—Ç –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏:', err);
                showMessage('error', '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç');
            } finally {
                document.body.removeChild(textarea);
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Å–æ—Ü. —Å–µ—Ç—è–º–∏
            const shareModal = `
                <div class="share-modal">
                    <div class="share-modal-content">
                        <h3>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∏—Å—Ç–æ—Ä–∏–µ–π</h3>
                        <div class="share-buttons">
                            <a href="https://vk.com/share.php?url=${encodeURIComponent(shareUrl)}&title=${encodeURIComponent(story.title)}" 
                               target="_blank" class="share-button vk">
                                –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
                            </a>
                            <a href="https://t.me/share/url?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(story.title)}" 
                               target="_blank" class="share-button telegram">
                                Telegram
                            </a>
                            <button class="share-button copy" onclick="copyToClipboard('${encodeURIComponent(shareText)}')">
                                –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                            </button>
                        </div>
                        <button class="close-modal" onclick="closeShareModal()">‚úñ</button>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', shareModal);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
        function copyToClipboard(text) {
            const decodedText = decodeURIComponent(text);
            navigator.clipboard.writeText(decodedText)
                .then(() => {
                    showMessage('success', '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
                })
                .catch(err => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏:', err);
                    showMessage('error', '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç');
                });
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeShareModal() {
            const modal = document.querySelector('.share-modal');
            if (modal) {
                modal.remove();
            }
        }
    </script>
</body>
</html> 
