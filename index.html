<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–∞–π—Ç —Å –∏—Å—Ç–æ—Ä–∏—è–º–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .story-container {
            background-color: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .story-title {
            color: #333;
            font-size: 24px;
            margin-bottom: 10px;
        }
        .story-text {
            line-height: 1.6;
            color: #444;
        }
        .nav-menu {
            background-color: #333;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .nav-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            gap: 20px;
        }
        .nav-menu a {
            color: white;
            text-decoration: none;
            font-size: 18px;
            transition: color 0.3s;
        }
        .nav-menu a:hover {
            color: #ffd700;
        }
        .story-form {
            background-color: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .story-form h2 {
            color: #333;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #444;
        }
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .form-group textarea {
            height: 200px;
            resize: vertical;
        }
        .submit-button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .submit-button:hover {
            background-color: #45a049;
        }
        .story-author {
            color: #666;
            font-style: italic;
            margin-bottom: 10px;
        }
        
        .story-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        
        .like-button, .share-button {
            padding: 5px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .like-button {
            background-color: #ff4d4d;
            color: white;
            padding: 5px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .like-button.liked {
            background-color: #ff3333;
            opacity: 0.8;
        }
        
        .like-button[disabled] {
            background-color: #ccc;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .like-button:hover:not([disabled]) {
            background-color: #ff3333;
        }
        
        .share-button {
            background-color: #4d79ff;
            color: white;
        }
        
        .share-button:hover {
            background-color: #3366ff;
        }
        
        .stories-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .message {
            padding: 10px 20px;
            border-radius: 4px;
            margin: 10px 0;
            display: none;
        }
        
        .success-message {
            background-color: #dff0d8;
            color: #3c763d;
            border: 1px solid #d6e9c6;
        }
        
        .error-message {
            background-color: #f2dede;
            color: #a94442;
            border: 1px solid #ebccd1;
        }
        
        .form-group .error {
            color: #a94442;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        .search-container {
            margin: 20px 0;
            position: relative;
        }
        
        #searchInput {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        #searchInput:focus {
            border-color: #4CAF50;
            box-shadow: 0 2px 8px rgba(76,175,80,0.2);
            outline: none;
        }
        
        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }
        
        .story-container.hidden {
            display: none;
        }
        
        .no-results {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
            display: none;
        }
        .auth-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
            display: none;
        }
        
        .auth-container.active {
            display: block;
        }
        
        .auth-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .auth-info {
            display: none;
            align-items: center;
            gap: 10px;
        }
        
        .auth-info.active {
            display: flex;
        }
        
        .logout-button {
            background-color: #ff4444;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .user-name {
            font-weight: bold;
            color: #333;
        }
        
        #myStoriesBtn {
            background-color: #4CAF50;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        #myStoriesBtn:hover {
            background-color: #45a049;
        }
        
        .nav-menu button.active {
            background-color: #45a049;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .no-stories-message {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <nav class="nav-menu">
        <ul>
            <li><a href="#home">–ì–ª–∞–≤–Ω–∞—è</a></li>
            <li><a href="#stories">–í—Å–µ –∏—Å—Ç–æ—Ä–∏–∏</a></li>
            <li><a href="#new">–ù–æ–≤—ã–µ –∏—Å—Ç–æ—Ä–∏–∏</a></li>
            <li><a href="#popular">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</a></li>
            <li><a href="#about">–û –Ω–∞—Å</a></li>
            <li><button id="myStoriesBtn" onclick="showMyStories()" style="display: none;">–ú–æ–∏ –∏—Å—Ç–æ—Ä–∏–∏</button></li>
            <li class="auth-buttons" id="authButtons">
                <button onclick="showAuthForm('login')">–í–æ–π—Ç–∏</button>
                <button onclick="showAuthForm('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </li>
            <li class="auth-info" id="authInfo">
                <span class="user-name" id="userName"></span>
                <button class="logout-button" onclick="logout()">–í—ã–π—Ç–∏</button>
            </li>
        </ul>
    </nav>
    
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –∏—Å—Ç–æ—Ä–∏–π</h1>
    
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∞–≤—Ç–æ—Ä—É –∏–ª–∏ —Ç–µ–∫—Å—Ç—É –∏—Å—Ç–æ—Ä–∏–∏...">
        <span class="search-icon">üîç</span>
    </div>
    
    <div id="noResults" class="no-results">
        –ò—Å—Ç–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
    </div>

    <!-- –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∏—Å—Ç–æ—Ä–∏–π -->
    <div class="stories-container">
        <!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ -->
        <div class="story-container">
            <h2 class="story-title">–ò—Å—Ç–æ—Ä–∏—è 1</h2>
            <div class="story-text">
                –í –æ–¥–∏–Ω –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–π –¥–µ–Ω—å –≤ –º–∞–ª–µ–Ω—å–∫–æ–º –≥–æ—Ä–æ–¥–∫–µ —Å–ª—É—á–∏–ª–æ—Å—å –Ω–µ—á—Ç–æ –Ω–µ–æ–±—ã—á–Ω–æ–µ. 
                –í—Å–µ –∂–∏—Ç–µ–ª–∏ –ø—Ä–æ—Å–Ω—É–ª–∏—Å—å –∏ –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏, —á—Ç–æ –∏—Ö –¥–æ–º–∞ –æ–∫—Ä–∞—Å–∏–ª–∏—Å—å –≤ —Ä–∞–∑–Ω—ã–µ —Ü–≤–µ—Ç–∞ —Ä–∞–¥—É–≥–∏. 
                –ù–∏–∫—Ç–æ –Ω–µ –∑–Ω–∞–ª, –∫–∞–∫ —ç—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ, –Ω–æ —ç—Ç–æ—Ç –¥–µ–Ω—å –Ω–∞–≤—Å–µ–≥–¥–∞ –∏–∑–º–µ–Ω–∏–ª –∂–∏–∑–Ω—å –≥–æ—Ä–æ–∂–∞–Ω...
            </div>
        </div>

        <div class="story-container">
            <h2 class="story-title">–ò—Å—Ç–æ—Ä–∏—è 2</h2>
            <div class="story-text">
                –ù–∞ –æ–∫—Ä–∞–∏–Ω–µ –ª–µ—Å–∞ –∂–∏–ª —Å—Ç–∞—Ä—ã–π –º—É–¥—Ä–µ—Ü, –∫–æ—Ç–æ—Ä—ã–π –∑–Ω–∞–ª —è–∑—ã–∫ –∂–∏–≤–æ—Ç–Ω—ã—Ö. 
                –ö–∞–∂–¥–æ–µ —É—Ç—Ä–æ –∫ –Ω–µ–º—É –ø—Ä–∏—Ö–æ–¥–∏–ª–∏ –ª–µ—Å–Ω—ã–µ –∂–∏—Ç–µ–ª–∏ –∏ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–ª–∏ —Å–≤–æ–∏ –∏—Å—Ç–æ—Ä–∏–∏. 
                –û–¥–Ω–∞–∂–¥—ã –ø—Ä–æ–∏–∑–æ—à–ª–æ —á—Ç–æ-—Ç–æ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ —É–¥–∏–≤–∏—Ç–µ–ª—å–Ω–æ–µ...
            </div>
        </div>
    </div>

    <div class="story-form">
        <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∏—Å—Ç–æ—Ä–∏—é</h2>
        <div id="successMessage" class="message success-message">–ò—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!</div>
        <div id="errorMessage" class="message error-message"></div>
        <form id="newStoryForm">
            <div class="form-group">
                <label for="storyTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏:</label>
                <input type="text" id="storyTitle" name="storyTitle" required>
                <div class="error" id="titleError"></div>
            </div>
            
            <div class="form-group">
                <label for="storyText">–¢–µ–∫—Å—Ç –∏—Å—Ç–æ—Ä–∏–∏:</label>
                <textarea id="storyText" name="storyText" required></textarea>
                <div class="error" id="textError"></div>
            </div>
            
            <button type="submit" class="submit-button">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
        </form>
    </div>

    <div class="auth-container" id="authContainer">
        <h2 id="authTitle">–í—Ö–æ–¥</h2>
        <form id="authForm">
            <div class="form-group">
                <label for="username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                <input type="text" id="username" name="username" required>
                <div class="error" id="usernameError"></div>
            </div>
            
            <div class="form-group">
                <label for="password">–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="password" name="password" required>
                <div class="error" id="passwordError"></div>
            </div>
            
            <button type="submit" class="submit-button">–í–æ–π—Ç–∏</button>
        </form>
    </div>

    <script>
        function validateStory(data) {
            let isValid = true;
            const errors = {};
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è
            if (data.storyTitle.length < 3) {
                errors.title = '–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞';
                isValid = false;
            } else if (data.storyTitle.length > 100) {
                errors.title = '–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å 100 —Å–∏–º–≤–æ–ª–æ–≤';
                isValid = false;
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –∏—Å—Ç–æ—Ä–∏–∏
            if (data.storyText.length < 10) {
                errors.text = '–ò—Å—Ç–æ—Ä–∏—è –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤';
                isValid = false;
            } else if (data.storyText.length > 5000) {
                errors.text = '–ò—Å—Ç–æ—Ä–∏—è –Ω–µ –¥–æ–ª–∂–Ω–∞ –ø—Ä–µ–≤—ã—à–∞—Ç—å 5000 —Å–∏–º–≤–æ–ª–æ–≤';
                isValid = false;
            }
            
            return { isValid, errors };
        }

        function showError(fieldId, message) {
            const errorDiv = document.getElementById(`${fieldId}Error`);
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function clearErrors() {
            const errorDivs = document.querySelectorAll('.error');
            errorDivs.forEach(div => div.style.display = 'none');
        }

        function showMessage(type, message) {
            const successMsg = document.getElementById('successMessage');
            const errorMsg = document.getElementById('errorMessage');
            
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';
            
            if (type === 'success') {
                successMsg.style.display = 'block';
            } else {
                errorMsg.textContent = message;
                errorMsg.style.display = 'block';
            }
            
            setTimeout(() => {
                successMsg.style.display = 'none';
                errorMsg.style.display = 'none';
            }, 3000);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–π –≤ localStorage
        function saveStoriesToLocalStorage(stories) {
            localStorage.setItem('stories', JSON.stringify(stories));
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–π –∏–∑ localStorage
        function getStoriesFromLocalStorage() {
            const stories = localStorage.getItem('stories');
            return stories ? JSON.parse(stories) : [];
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–π
        function displayStories(storiesFilter = null) {
            const storiesContainer = document.querySelector('.stories-container');
            const stories = getStoriesFromLocalStorage();
            const currentUser = getCurrentUser();
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏–∏, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω —Ñ–∏–ª—å—Ç—Ä
            const filteredStories = storiesFilter ? 
                stories.filter(storiesFilter) : 
                stories;
            
            storiesContainer.innerHTML = ''; // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
            
            if (filteredStories.length === 0) {
                storiesContainer.innerHTML = `
                    <div class="no-stories-message">
                        ${storiesFilter ? '–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∏—Å—Ç–æ—Ä–∏–π' : '–ò—Å—Ç–æ—Ä–∏–π –ø–æ–∫–∞ –Ω–µ—Ç'}
                    </div>
                `;
                return;
            }
            
            filteredStories.forEach(story => {
                const hasLiked = currentUser && story.likedBy && story.likedBy.includes(currentUser.username);
                const likeButtonClass = hasLiked ? 'like-button liked' : 'like-button';
                const likeButtonDisabled = !currentUser ? 'disabled' : '';
                const likeTitle = !currentUser ? '–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫' : 
                                hasLiked ? '–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å –ª–∞–π–∫' : '–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫';
                
                const storyHTML = `
                    <div class="story-container">
                        <h2 class="story-title">${story.storyTitle}</h2>
                        <p class="story-author">–ê–≤—Ç–æ—Ä: ${story.authorName}</p>
                        <div class="story-text">${story.storyText}</div>
                        <div class="story-actions">
                            <button class="${likeButtonClass}" ${likeButtonDisabled} 
                                title="${likeTitle}"
                            >‚ù§ ${story.likes || 0}</button>
                            <button class="share-button">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
                        </div>
                    </div>
                `;
                storiesContainer.insertAdjacentHTML('afterbegin', storyHTML);
            });
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function showMyStories() {
            const currentUser = getCurrentUser();
            if (!currentUser) {
                showMessage('error', '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
            const allButtons = document.querySelectorAll('.nav-menu button, .nav-menu a');
            allButtons.forEach(btn => btn.classList.remove('active'));
            document.getElementById('myStoriesBtn').classList.add('active');
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –∏—Å—Ç–æ—Ä–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            displayStories(story => story.authorName === currentUser.username);
            
            showMessage('success', '–ü–æ–∫–∞–∑–∞–Ω—ã –≤–∞—à–∏ –∏—Å—Ç–æ—Ä–∏–∏');
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–í—Å–µ –∏—Å—Ç–æ—Ä–∏–∏"
        document.querySelector('a[href="#stories"]').addEventListener('click', (e) => {
            e.preventDefault();
            const allButtons = document.querySelectorAll('.nav-menu button, .nav-menu a');
            allButtons.forEach(btn => btn.classList.remove('active'));
            e.target.classList.add('active');
            displayStories();
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        document.getElementById('newStoryForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            clearErrors();
            
            const currentUser = getCurrentUser();
            if (!currentUser) {
                showMessage('error', '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            const formData = new FormData(e.target);
            const storyData = Object.fromEntries(formData);
            
            const { isValid, errors } = validateStory(storyData);
            
            if (!isValid) {
                Object.keys(errors).forEach(key => {
                    showError(key, errors[key]);
                });
                return;
            }
            
            try {
                const newStory = {
                    ...storyData,
                    authorName: currentUser.username,
                    date: new Date().toISOString(),
                    likes: 0,
                    likedBy: []
                };
                
                const stories = getStoriesFromLocalStorage();
                stories.unshift(newStory);
                saveStoriesToLocalStorage(stories);
                
                displayStories();
                e.target.reset();
                showMessage('success');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏:', error);
                showMessage('error', '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏');
            }
        });

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function searchStories(query) {
            const stories = document.querySelectorAll('.story-container');
            const noResults = document.getElementById('noResults');
            let hasVisibleStories = false;
            
            stories.forEach(story => {
                const title = story.querySelector('.story-title').textContent.toLowerCase();
                const text = story.querySelector('.story-text').textContent.toLowerCase();
                const author = story.querySelector('.story-author')?.textContent.toLowerCase() || '';
                
                const searchQuery = query.toLowerCase();
                
                if (title.includes(searchQuery) || 
                    text.includes(searchQuery) || 
                    author.includes(searchQuery)) {
                    story.classList.remove('hidden');
                    hasVisibleStories = true;
                } else {
                    story.classList.add('hidden');
                }
            });
            
            noResults.style.display = hasVisibleStories ? 'none' : 'block';
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è —Å debounce
        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('input', debounce((e) => {
            searchStories(e.target.value);
        }, 300));

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø–æ–∏—Å–∫–∞
        searchInput.addEventListener('keyup', (e) => {
            if (e.key === 'Escape') {
                searchInput.value = '';
                searchStories('');
            }
        });

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –≤ localStorage
        function saveUsers(users) {
            localStorage.setItem('users', JSON.stringify(users));
        }

        function getUsers() {
            return JSON.parse(localStorage.getItem('users') || '[]');
        }

        function getCurrentUser() {
            return JSON.parse(localStorage.getItem('currentUser'));
        }

        function setCurrentUser(user) {
            localStorage.setItem('currentUser', JSON.stringify(user));
            updateAuthUI();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function updateAuthUI() {
            const currentUser = getCurrentUser();
            const authButtons = document.getElementById('authButtons');
            const authInfo = document.getElementById('authInfo');
            const userName = document.getElementById('userName');
            const storyForm = document.querySelector('.story-form');
            const myStoriesBtn = document.getElementById('myStoriesBtn');
            
            if (currentUser) {
                authButtons.style.display = 'none';
                authInfo.classList.add('active');
                userName.textContent = currentUser.username;
                storyForm.style.display = 'block';
                myStoriesBtn.style.display = 'block';
            } else {
                authButtons.style.display = 'flex';
                authInfo.classList.remove('active');
                userName.textContent = '';
                storyForm.style.display = 'none';
                myStoriesBtn.style.display = 'none';
                // –ü—Ä–∏ –≤—ã—Ö–æ–¥–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –∏—Å—Ç–æ—Ä–∏–∏
                displayStories();
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function showAuthForm(type) {
            const authContainer = document.getElementById('authContainer');
            const authTitle = document.getElementById('authTitle');
            const authForm = document.getElementById('authForm');
            
            authContainer.classList.add('active');
            authTitle.textContent = type === 'login' ? '–í—Ö–æ–¥' : '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è';
            authForm.dataset.type = type;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        document.getElementById('authForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const type = e.target.dataset.type;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (type === 'register') {
                // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                const users = getUsers();
                if (users.some(u => u.username === username)) {
                    showError('username', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                    return;
                }
                
                const newUser = { username, password };
                users.push(newUser);
                saveUsers(users);
                setCurrentUser(newUser);
                showMessage('success', '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!');
            } else {
                // –í—Ö–æ–¥
                const users = getUsers();
                const user = users.find(u => u.username === username && u.password === password);
                
                if (user) {
                    setCurrentUser(user);
                    showMessage('success', '–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
                } else {
                    showMessage('error', '–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
                    return;
                }
            }
            
            document.getElementById('authContainer').classList.remove('active');
            e.target.reset();
        });

        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        function logout() {
            localStorage.removeItem('currentUser');
            updateAuthUI();
            showMessage('success', '–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            updateAuthUI();
            displayStories();
        });
    </script>
</body>
</html> 